# SPDX-FileCopyrightText: 2022-2026 Technology Innovation Institute (TII)
# SPDX-License-Identifier: Apache-2.0

FILE_PATH=$1

sleep 8

sudo iptables -A ghaf-fw-in-filter -p tcp --dport 5201 -j ACCEPT

echo "" > "${FILE_PATH}"/server_received.txt

for i in {1..40}
do
  echo "" >> "${FILE_PATH}"/server_received.txt
  echo "iteration $i - $(date)" >> "${FILE_PATH}"/server_received.txt
  timeout 1.7 nc -l 5201 >> "${FILE_PATH}"/server_received.txt 2>&1
  sleep 0.5
done

sudo iptables -A ghaf-fw-in-filter -p tcp --dport 5201 -j DROP